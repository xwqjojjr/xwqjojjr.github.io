
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>区块链猫源码分析_1 | 徐文起写字的地方</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="WenqiXu">
    
    <meta name="description" content="#以太坊猫的合约1234567contract KittyAccessControlcontract KittyBase is KittyAccessControlcontract KittyOwnership is KittyBase, ERC721contract KittyBreeding i">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="徐文起写字的地方" title="徐文起写字的地方"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="徐文起写字的地方">徐文起写字的地方</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:xuwenqi.info">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/03/19/区块链猫源码笔记_1/" title="区块链猫源码分析_1" itemprop="url">区块链猫源码分析_1</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://xuwenqi.info" title="WenqiXu">WenqiXu</a>
    </p>
  <p class="article-time">
    <time datetime="2018-03-19T04:56:19.829Z" itemprop="datePublished">2018-03-19</time>
    Updated:<time datetime="2018-03-06T13:13:28.000Z" itemprop="dateModified">2018-03-06</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#各个合约的代码"><span class="toc-number">1.</span> <span class="toc-text">各个合约的代码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GeneScienceInterface"><span class="toc-number">1.1.</span> <span class="toc-text">GeneScienceInterface</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ERC721"><span class="toc-number">1.1.1.</span> <span class="toc-text">ERC721</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KittyAccessConrtol"><span class="toc-number">1.2.</span> <span class="toc-text">KittyAccessConrtol</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ownable"><span class="toc-number">1.3.</span> <span class="toc-text">Ownable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#contract-KittyBase-区块链猫的主要代码"><span class="toc-number">1.4.</span> <span class="toc-text">contract KittyBase (区块链猫的主要代码)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#猫的结构体"><span class="toc-number">1.4.1.</span> <span class="toc-text">猫的结构体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pregnancy-time"><span class="toc-number">1.4.2.</span> <span class="toc-text">pregnancy time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#存储"><span class="toc-number">1.4.3.</span> <span class="toc-text">存储</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ERC721Metedata"><span class="toc-number">1.5.</span> <span class="toc-text">ERC721Metedata</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KittyOwnership"><span class="toc-number">1.6.</span> <span class="toc-text">KittyOwnership</span></a></li></ol></li></ol>
		</div>
		
		<p>#以太坊猫的合约<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">contract KittyAccessControl</span><br><span class="line">contract KittyBase is KittyAccessControl</span><br><span class="line">contract KittyOwnership is KittyBase, ERC721</span><br><span class="line">contract KittyBreeding is KittyOwnership</span><br><span class="line">contract KittyAuction is KittyBreeding</span><br><span class="line">contract KittyMinting is KittyAuction</span><br><span class="line">contract KittyCore is KittyMinting</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="各个合约的代码"><a href="#各个合约的代码" class="headerlink" title="各个合约的代码"></a>各个合约的代码</h1><h2 id="GeneScienceInterface"><a href="#GeneScienceInterface" class="headerlink" title="GeneScienceInterface"></a>GeneScienceInterface</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/// @title SEKRETOOOO</span><br><span class="line">contract GeneScienceInterface &#123;</span><br><span class="line">    /// @dev simply a boolean to indicate this is the contract we expect to be</span><br><span class="line">    function isGeneScience() public pure returns (bool);</span><br><span class="line"></span><br><span class="line">    /// @dev given genes of kitten 1 &amp; 2, return a genetic combination - may have a random factor</span><br><span class="line">    /// @param genes1 genes of mom</span><br><span class="line">    /// @param genes2 genes of sire</span><br><span class="line">    /// @return the genes that are supposed to be passed down the child</span><br><span class="line">    function mixGenes(uint256 genes1, uint256 genes2, uint256 targetBlock) public returns (uint256);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>唯一没有开源的代码，输入公猫母猫的基因，得出小猫的基因</p>
<h3 id="ERC721"><a href="#ERC721" class="headerlink" title="ERC721"></a>ERC721</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/// @title Interface for contracts conforming to ERC-721: Non-Fungible Tokens</span><br><span class="line">/// @author Dieter Shirley &lt;dete@axiomzen.co&gt; (https://github.com/dete)</span><br><span class="line">contract ERC721 &#123;</span><br><span class="line">    // Required methods</span><br><span class="line">    function totalSupply() public view returns (uint256 total);</span><br><span class="line">    function balanceOf(address _owner) public view returns (uint256 balance);</span><br><span class="line">    function ownerOf(uint256 _tokenId) external view returns (address owner);</span><br><span class="line">    function approve(address _to, uint256 _tokenId) external;</span><br><span class="line">    function transfer(address _to, uint256 _tokenId) external;</span><br><span class="line">    function transferFrom(address _from, address _to, uint256 _tokenId) external;</span><br><span class="line"></span><br><span class="line">    // Events</span><br><span class="line">    event Transfer(address from, address to, uint256 tokenId);</span><br><span class="line">    event Approval(address owner, address approved, uint256 tokenId);</span><br><span class="line"></span><br><span class="line">    // Optional</span><br><span class="line">    // function name() public view returns (string name);</span><br><span class="line">    // function symbol() public view returns (string symbol);</span><br><span class="line">    // function tokensOfOwner(address _owner) external view returns (uint256[] tokenIds);</span><br><span class="line">    // function tokenMetadata(uint256 _tokenId, string _preferredTransport) public view returns (string infoUrl);</span><br><span class="line"></span><br><span class="line">    // ERC-165 Compatibility (https://github.com/ethereum/EIPs/issues/165)</span><br><span class="line">    function supportsInterface(bytes4 _interfaceID) external view returns (bool);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ERC721 是以太坊中针对非同质代币的接口，本标准提出的用于智能合约内非同质代币（non-fungible tokens,以下简称 “NFTs”），操作标准API的实现方法。另外，本标准还提供了用于跟踪和所有权转移的基本功能。</p>
<p><a href="https://www.jianshu.com/p/898f645e8cef" target="_blank" rel="noopener">https://www.jianshu.com/p/898f645e8cef</a></p>
<p>ERC721兼容ERC20中的name、symbol、totalSupply和balanceOf方法,同时新增了ownerOf、takeOwnerShip重写了transfer和approve</p>
<h2 id="KittyAccessConrtol"><a href="#KittyAccessConrtol" class="headerlink" title="KittyAccessConrtol"></a>KittyAccessConrtol</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">/// @title A facet of KittyCore that manages special access privileges.</span><br><span class="line">/// @author Axiom Zen (https://www.axiomzen.co)</span><br><span class="line">/// @dev See the KittyCore contract documentation to understand how the various contract facets are arranged.</span><br><span class="line">contract KittyAccessControl &#123;</span><br><span class="line">    // This facet controls access control for CryptoKitties. There are four roles managed here:</span><br><span class="line">    //</span><br><span class="line">    //     - The CEO: The CEO can reassign other roles and change the addresses of our dependent smart</span><br><span class="line">    //         contracts. It is also the only role that can unpause the smart contract. It is initially</span><br><span class="line">    //         set to the address that created the smart contract in the KittyCore constructor.</span><br><span class="line">    //</span><br><span class="line">    //     - The CFO: The CFO can withdraw funds from KittyCore and its auction contracts.</span><br><span class="line">    //</span><br><span class="line">    //     - The COO: The COO can release gen0 kitties to auction, and mint promo cats.</span><br><span class="line">    //</span><br><span class="line">    // It should be noted that these roles are distinct without overlap in their access abilities, the</span><br><span class="line">    // abilities listed for each role above are exhaustive. In particular, while the CEO can assign any</span><br><span class="line">    // address to any role, the CEO address itself doesn&apos;t have the ability to act in those roles. This</span><br><span class="line">    // restriction is intentional so that we aren&apos;t tempted to use the CEO address frequently out of</span><br><span class="line">    // convenience. The less we use an address, the less likely it is that we somehow compromise the</span><br><span class="line">    // account.</span><br><span class="line"></span><br><span class="line">    /// @dev Emited when contract is upgraded - See README.md for updgrade plan</span><br><span class="line">    event ContractUpgrade(address newContract);</span><br><span class="line"></span><br><span class="line">    // The addresses of the accounts (or contracts) that can execute actions within each roles.</span><br><span class="line">    address public ceoAddress;</span><br><span class="line">    address public cfoAddress;</span><br><span class="line">    address public cooAddress;</span><br><span class="line"></span><br><span class="line">    // @dev Keeps track whether the contract is paused. When that is true, most actions are blocked</span><br><span class="line">    bool public paused = false;</span><br><span class="line"></span><br><span class="line">    /// @dev Access modifier for CEO-only functionality</span><br><span class="line">    modifier onlyCEO() &#123;</span><br><span class="line">        require(msg.sender == ceoAddress);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// @dev Access modifier for CFO-only functionality</span><br><span class="line">    modifier onlyCFO() &#123;</span><br><span class="line">        require(msg.sender == cfoAddress);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// @dev Access modifier for COO-only functionality</span><br><span class="line">    modifier onlyCOO() &#123;</span><br><span class="line">        require(msg.sender == cooAddress);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyCLevel() &#123;</span><br><span class="line">        require(</span><br><span class="line">            msg.sender == cooAddress ||</span><br><span class="line">            msg.sender == ceoAddress ||</span><br><span class="line">            msg.sender == cfoAddress</span><br><span class="line">        );</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// @dev Assigns a new address to act as the CEO. Only available to the current CEO.</span><br><span class="line">    /// @param _newCEO The address of the new CEO</span><br><span class="line">    function setCEO(address _newCEO) external onlyCEO &#123;</span><br><span class="line">        require(_newCEO != address(0));</span><br><span class="line"></span><br><span class="line">        ceoAddress = _newCEO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// @dev Assigns a new address to act as the CFO. Only available to the current CEO.</span><br><span class="line">    /// @param _newCFO The address of the new CFO</span><br><span class="line">    function setCFO(address _newCFO) external onlyCEO &#123;</span><br><span class="line">        require(_newCFO != address(0));</span><br><span class="line"></span><br><span class="line">        cfoAddress = _newCFO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// @dev Assigns a new address to act as the COO. Only available to the current CEO.</span><br><span class="line">    /// @param _newCOO The address of the new COO</span><br><span class="line">    function setCOO(address _newCOO) external onlyCEO &#123;</span><br><span class="line">        require(_newCOO != address(0));</span><br><span class="line"></span><br><span class="line">        cooAddress = _newCOO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /*** Pausable functionality adapted from OpenZeppelin ***/</span><br><span class="line"></span><br><span class="line">    /// @dev Modifier to allow actions only when the contract IS NOT paused</span><br><span class="line">    modifier whenNotPaused() &#123;</span><br><span class="line">        require(!paused);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// @dev Modifier to allow actions only when the contract IS paused</span><br><span class="line">    modifier whenPaused &#123;</span><br><span class="line">        require(paused);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// @dev Called by any &quot;C-level&quot; role to pause the contract. Used only when</span><br><span class="line">    ///  a bug or exploit is detected and we need to limit damage.</span><br><span class="line">    function pause() external onlyCLevel whenNotPaused &#123;</span><br><span class="line">        paused = true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// @dev Unpauses the smart contract. Can only be called by the CEO, since</span><br><span class="line">    ///  one reason we may pause the contract is when CFO or COO accounts are</span><br><span class="line">    ///  compromised.</span><br><span class="line">    /// @notice This is public rather than external so it can be called by</span><br><span class="line">    ///  derived contracts.</span><br><span class="line">    function unpause() public onlyCEO whenPaused &#123;</span><br><span class="line">        // can&apos;t unpause if contract was upgraded</span><br><span class="line">        paused = false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>区块链猫中有三种角色，分别是CEO、CFO、COO<br>CEO是可以控制其他角色并且改变合约的地址，他也是唯一可以启动合约的角色。<br>CFO可以撤销和资产<br>COO可以放出第0代猫</p>
<hr>
<h2 id="Ownable"><a href="#Ownable" class="headerlink" title="Ownable"></a>Ownable</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">contract Ownable &#123;</span><br><span class="line">  address public owner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev The Ownable constructor sets the original `owner` of the contract to the sender</span><br><span class="line">   * account.</span><br><span class="line">   */</span><br><span class="line">  function Ownable() &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Throws if called by any account other than the owner.</span><br><span class="line">   */</span><br><span class="line">  modifier onlyOwner() &#123;</span><br><span class="line">    require(msg.sender == owner);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Allows the current owner to transfer control of the contract to a newOwner.</span><br><span class="line">   * @param newOwner The address to transfer ownership to.</span><br><span class="line">   */</span><br><span class="line">  function transferOwnership(address newOwner) onlyOwner &#123;</span><br><span class="line">    if (newOwner != address(0)) &#123;</span><br><span class="line">      owner = newOwner;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义了所有权，她的作用类似一个抽象的基类，后续的类通过继承她来简化代码。<br><br>modifier也是以太的关键字，定义一个修饰符，她写在函数最后，在函数执行前，先执行修饰符中代码。一般修饰符代码都是权限检查等等。</p>
<hr>
<h2 id="contract-KittyBase-区块链猫的主要代码"><a href="#contract-KittyBase-区块链猫的主要代码" class="headerlink" title="contract KittyBase (区块链猫的主要代码)"></a>contract KittyBase (区块链猫的主要代码)</h2><h3 id="猫的结构体"><a href="#猫的结构体" class="headerlink" title="猫的结构体"></a>猫的结构体</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Kitty&#123;</span><br><span class="line">  uint256 genes;  //本猫的256位基因</span><br><span class="line">  uint32 matronId;//母猫的id</span><br><span class="line">  uint32 sireId; //公猫的id</span><br><span class="line">                 //2的32次方等于4 294 967 296大概是4亿，以太坊网络每年大约处理500 million的交易，所以不用担心id用光</span><br><span class="line">  uint32 siringWithId; //把怀孕的母猫的id放到小猫上，当小猫出生后，用来获取小猫的基因</span><br><span class="line">  uint16 cooldownIndex; //一个表示每只猫的冷却时间按的索引</span><br><span class="line">  uint16 generation;  //表示这只猫是第几代，猫的代数由父母中最大的那代+1得到</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">struct Kitty &#123;</span><br><span class="line">        // The Kitty&apos;s genetic code is packed into these 256-bits, the format is</span><br><span class="line">        // sooper-sekret! A cat&apos;s genes never change.</span><br><span class="line">        uint256 genes;</span><br><span class="line"></span><br><span class="line">        // The timestamp from the block when this cat came into existence.</span><br><span class="line">        uint64 birthTime;</span><br><span class="line"></span><br><span class="line">        // The minimum timestamp after which this cat can engage in breeding</span><br><span class="line">        // activities again. This same timestamp is used for the pregnancy</span><br><span class="line">        // timer (for matrons) as well as the siring cooldown.</span><br><span class="line">        uint64 cooldownEndBlock;</span><br><span class="line"></span><br><span class="line">        // The ID of the parents of this kitty, set to 0 for gen0 cats.</span><br><span class="line">        // Note that using 32-bit unsigned integers limits us to a &quot;mere&quot;</span><br><span class="line">        // 4 billion cats. This number might seem small until you realize</span><br><span class="line">        // that Ethereum currently has a limit of about 500 million</span><br><span class="line">        // transactions per year! So, this definitely won&apos;t be a problem</span><br><span class="line">        // for several years (even as Ethereum learns to scale).</span><br><span class="line">        uint32 matronId;</span><br><span class="line">        uint32 sireId;</span><br><span class="line"></span><br><span class="line">        // Set to the ID of the sire cat for matrons that are pregnant,</span><br><span class="line">        // zero otherwise. A non-zero value here is how we know a cat</span><br><span class="line">        // is pregnant. Used to retrieve the genetic material for the new</span><br><span class="line">        // kitten when the birth transpires.</span><br><span class="line">        uint32 siringWithId;</span><br><span class="line"></span><br><span class="line">        // Set to the index in the cooldown array (see below) that represents</span><br><span class="line">        // the current cooldown duration for this Kitty. This starts at zero</span><br><span class="line">        // for gen0 cats, and is initialized to floor(generation/2) for others.</span><br><span class="line">        // Incremented by one for each successful breeding action, regardless</span><br><span class="line">        // of whether this cat is acting as matron or sire.</span><br><span class="line">        uint16 cooldownIndex;</span><br><span class="line"></span><br><span class="line">        // The &quot;generation number&quot; of this cat. Cats minted by the CK contract</span><br><span class="line">        // for sale are called &quot;gen0&quot; and have a generation number of 0. The</span><br><span class="line">        // generation number of all other cats is the larger of the two generation</span><br><span class="line">        // numbers of their parents, plus one.</span><br><span class="line">        // (i.e. max(matron.generation, sire.generation) + 1)</span><br><span class="line">        uint16 generation;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="pregnancy-time"><a href="#pregnancy-time" class="headerlink" title="pregnancy time"></a>pregnancy time</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/*** CONSTANTS ***/</span><br><span class="line"></span><br><span class="line">/// @dev A lookup table indicating the cooldown duration after any successful</span><br><span class="line">///  breeding action, called &quot;pregnancy time&quot; for matrons and &quot;siring cooldown&quot;</span><br><span class="line">///  for sires. Designed such that the cooldown roughly doubles each time a cat</span><br><span class="line">///  is bred, encouraging owners not to just keep breeding the same cat over</span><br><span class="line">///  and over again. Caps out at one week (a cat can breed an unbounded number</span><br><span class="line">///  of times, and the maximum cooldown is always seven days).</span><br><span class="line">uint32[14] public cooldowns = [</span><br><span class="line">    uint32(1 minutes),</span><br><span class="line">    uint32(2 minutes),</span><br><span class="line">    uint32(5 minutes),</span><br><span class="line">    uint32(10 minutes),</span><br><span class="line">    uint32(30 minutes),</span><br><span class="line">    uint32(1 hours),</span><br><span class="line">    uint32(2 hours),</span><br><span class="line">    uint32(4 hours),</span><br><span class="line">    uint32(8 hours),</span><br><span class="line">    uint32(16 hours),</span><br><span class="line">    uint32(1 days),</span><br><span class="line">    uint32(2 days),</span><br><span class="line">    uint32(4 days),</span><br><span class="line">    uint32(7 days)</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">// An approximation of currently how many seconds are in between blocks.</span><br><span class="line">uint256 public secondsPerBlock = 15;</span><br></pre></td></tr></table></figure>
<p><strong>coolwoens</strong> 是一个用于表示冷却时间的查找表，每只猫繁殖过后都会进入一个休息时间 “pregnancy time”,这个休息时间基本上是翻倍增长的，从1分钟到2分钟、5分钟……1个小时、2个小时最后到一周的时间，每只猫的休息时间最长就是一周。</p>
<p><strong>secondsPerBlock</strong> 近似表示以太坊中每个块之间的时间间隔<br></p>
<h3 id="存储"><a href="#存储" class="headerlink" title="存储"></a>存储</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">一个数组包含了所有的Kitty，每只猫的Id其实是数组中的索引。主意，Id 0是不是一只通常意义的猫&lt;/br&gt;</span><br><span class="line">这只虚构的猫实际上是所有gen0代的猫的父母(gen0既是公的又是母的)&lt;/br&gt;</span><br><span class="line">从另一方面讲，Id 0其实是非法的 ;-)&lt;/br&gt;&lt;/br&gt;</span><br><span class="line">/*** STORAGE ***/</span><br><span class="line"></span><br><span class="line">    /// @dev An array containing the Kitty struct for all Kitties in existence. The ID</span><br><span class="line">    ///  of each cat is actually an index into this array. Note that ID 0 is a negacat,</span><br><span class="line">    ///  the unKitty, the mythical beast that is the parent of all gen0 cats. A bizarre</span><br><span class="line">    ///  creature that is both matron and sire... to itself! Has an invalid genetic code.</span><br><span class="line">    ///  In other words, cat ID 0 is invalid... ;-)</span><br><span class="line">    Kitty[] kitties;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">从猫的Id到所有者的映射</span><br><span class="line">/// @dev A mapping from cat IDs to the address that owns them. All cats have</span><br><span class="line">///  some valid owner address, even gen0 cats are created with a non-zero owner.</span><br><span class="line">mapping (uint256 =&gt; address) public kittyIndexToOwner;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询账户所有的Token代币</span><br><span class="line">// @dev A mapping from owner address to count of tokens that address owns.</span><br><span class="line">//  Used internally inside balanceOf() to resolve ownership count.</span><br><span class="line">mapping (address =&gt; uint256) ownershipTokenCount;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">把猫的Id映射到待交易的地址</span><br><span class="line">/// @dev A mapping from KittyIDs to an address that has been approved to call</span><br><span class="line">///  transferFrom(). Each Kitty can only have one approved address for transfer</span><br><span class="line">///  at any time. A zero value means no approval is outstanding.</span><br><span class="line">mapping (uint256 =&gt; address) public kittyIndexToApproved;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">把猫的Id映射到待繁殖的地址</span><br><span class="line">/// @dev A mapping from KittyIDs to an address that has been approved to use</span><br><span class="line">///  this Kitty for siring via breedWith(). Each Kitty can only have one approved</span><br><span class="line">///  address for siring at any time. A zero value means no approval is outstanding.</span><br><span class="line">mapping (uint256 =&gt; address) public sireAllowedToAddress;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">saleAuction合约的地址处理所有猫之间的交易，并且每15分钟放出一只新的0代猫</span><br><span class="line">/// @dev The address of the ClockAuction contract that handles sales of Kitties. This</span><br><span class="line">///  same contract handles both peer-to-peer sales as well as the gen0 sales which are</span><br><span class="line">///  initiated every 15 minutes.</span><br><span class="line">SaleClockAuction public saleAuction;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SiringClockAuction处理猫之间的繁殖</span><br><span class="line"> /// @dev The address of a custom ClockAuction subclassed contract that handles siring</span><br><span class="line"> ///  auctions. Needs to be separate from saleAuction because the actions taken on success</span><br><span class="line"> ///  after a sales and siring auction are quite different.</span><br><span class="line"> SiringClockAuction public siringAuction;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">交易方法</span><br><span class="line">/// @dev Assigns ownership of a specific Kitty to an address.</span><br><span class="line">  function _transfer(address _from, address _to, uint256 _tokenId) internal &#123;</span><br><span class="line">      // Since the number of kittens is capped to 2^32 we can&apos;t overflow this</span><br><span class="line">      ownershipTokenCount[_to]++;</span><br><span class="line">      // transfer ownership</span><br><span class="line">      kittyIndexToOwner[_tokenId] = _to;</span><br><span class="line">      // When creating new kittens _from is 0x0, but we can&apos;t account that address.</span><br><span class="line">      if (_from != address(0)) &#123;</span><br><span class="line">          ownershipTokenCount[_from]--;</span><br><span class="line">          // once the kitten is transferred also clear sire allowances</span><br><span class="line">          delete sireAllowedToAddress[_tokenId];</span><br><span class="line">          // clear any previously approved ownership exchange</span><br><span class="line">          delete kittyIndexToApproved[_tokenId];</span><br><span class="line">      &#125;</span><br><span class="line">      // Emit the transfer event.</span><br><span class="line">      Transfer(_from, _to, _tokenId);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">生成一只新的小猫并且存储它。方法不检查值是否合法。方法将会调用Birth事件和Transfer事件</span><br><span class="line">/// @dev An internal method that creates a new kitty and stores it. This</span><br><span class="line">    ///  method doesn&apos;t do any checking and should only be called when the</span><br><span class="line">    ///  input data is known to be valid. Will generate both a Birth event</span><br><span class="line">    ///  and a Transfer event.</span><br><span class="line">    /// @param _matronId The kitty ID of the matron of this cat (zero for gen0)</span><br><span class="line">    /// @param _sireId The kitty ID of the sire of this cat (zero for gen0)</span><br><span class="line">    /// @param _generation The generation number of this cat, must be computed by caller.</span><br><span class="line">    /// @param _genes The kitty&apos;s genetic code.</span><br><span class="line">    /// @param _owner The inital owner of this cat, must be non-zero (except for the unKitty, ID 0)</span><br><span class="line">    function _createKitty(</span><br><span class="line">        uint256 _matronId,</span><br><span class="line">        uint256 _sireId,</span><br><span class="line">        uint256 _generation,</span><br><span class="line">        uint256 _genes,</span><br><span class="line">        address _owner</span><br><span class="line">    )</span><br><span class="line">        internal</span><br><span class="line">        returns (uint)</span><br><span class="line">    &#123;</span><br><span class="line">        // These requires are not strictly necessary, our calling code should make</span><br><span class="line">        // sure that these conditions are never broken. However! _createKitty() is already</span><br><span class="line">        // an expensive call (for storage), and it doesn&apos;t hurt to be especially careful</span><br><span class="line">        // to ensure our data structures are always valid.</span><br><span class="line">        require(_matronId == uint256(uint32(_matronId)));</span><br><span class="line">        require(_sireId == uint256(uint32(_sireId)));</span><br><span class="line">        require(_generation == uint256(uint16(_generation)));</span><br><span class="line"></span><br><span class="line">        // New kitty starts with the same cooldown as parent gen/2</span><br><span class="line">        uint16 cooldownIndex = uint16(_generation / 2);</span><br><span class="line">        if (cooldownIndex &gt; 13) &#123;</span><br><span class="line">            cooldownIndex = 13;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Kitty memory _kitty = Kitty(&#123;</span><br><span class="line">            genes: _genes,</span><br><span class="line">            birthTime: uint64(now),</span><br><span class="line">            cooldownEndBlock: 0,</span><br><span class="line">            matronId: uint32(_matronId),</span><br><span class="line">            sireId: uint32(_sireId),</span><br><span class="line">            siringWithId: 0,</span><br><span class="line">            cooldownIndex: cooldownIndex,</span><br><span class="line">            generation: uint16(_generation)</span><br><span class="line">        &#125;);</span><br><span class="line">        uint256 newKittenId = kitties.push(_kitty) - 1;</span><br><span class="line"></span><br><span class="line">        // It&apos;s probably never going to happen, 4 billion cats is A LOT, but</span><br><span class="line">        // let&apos;s just be 100% sure we never let this happen.</span><br><span class="line">        require(newKittenId == uint256(uint32(newKittenId)));</span><br><span class="line"></span><br><span class="line">        // emit the birth event</span><br><span class="line">        Birth(</span><br><span class="line">            _owner,</span><br><span class="line">            newKittenId,</span><br><span class="line">            uint256(_kitty.matronId),</span><br><span class="line">            uint256(_kitty.sireId),</span><br><span class="line">            _kitty.genes</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        // This will assign ownership, and also emit the Transfer event as</span><br><span class="line">        // per ERC721 draft</span><br><span class="line">        _transfer(0, _owner, newKittenId);</span><br><span class="line"></span><br><span class="line">        return newKittenId;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ERC721Metedata"><a href="#ERC721Metedata" class="headerlink" title="ERC721Metedata"></a>ERC721Metedata</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/// @title The external contract that is responsible for generating metadata for the kitties,</span><br><span class="line">///  it has one function that will return the data as bytes.</span><br><span class="line">contract ERC721Metadata &#123;</span><br><span class="line">    /// @dev Given a token Id, returns a byte array that is supposed to be converted into string.</span><br><span class="line">    function getMetadata(uint256 _tokenId, string) public view returns (bytes32[4] buffer, uint256 count) &#123;</span><br><span class="line">        if (_tokenId == 1) &#123;</span><br><span class="line">            buffer[0] = &quot;Hello World! :D&quot;;</span><br><span class="line">            count = 15;</span><br><span class="line">        &#125; else if (_tokenId == 2) &#123;</span><br><span class="line">            buffer[0] = &quot;I would definitely choose a medi&quot;;</span><br><span class="line">            buffer[1] = &quot;um length string.&quot;;</span><br><span class="line">            count = 49;</span><br><span class="line">        &#125; else if (_tokenId == 3) &#123;</span><br><span class="line">            buffer[0] = &quot;Lorem ipsum dolor sit amet, mi e&quot;;</span><br><span class="line">            buffer[1] = &quot;st accumsan dapibus augue lorem,&quot;;</span><br><span class="line">            buffer[2] = &quot; tristique vestibulum id, libero&quot;;</span><br><span class="line">            buffer[3] = &quot; suscipit varius sapien aliquam.&quot;;</span><br><span class="line">            count = 128;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="KittyOwnership"><a href="#KittyOwnership" class="headerlink" title="KittyOwnership"></a>KittyOwnership</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">区块链猫代币的名字和缩写</span><br><span class="line">/// @notice Name and symbol of the non fungible token, as defined in ERC721.</span><br><span class="line">string public constant name = &quot;CryptoKitties&quot;;</span><br><span class="line">string public constant symbol = &quot;CK&quot;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ERC721和ERC165</span><br><span class="line">bytes4 constant InterfaceSignature_ERC165 =</span><br><span class="line">    bytes4(keccak256(&apos;supportsInterface(bytes4)&apos;));</span><br><span class="line"></span><br><span class="line">bytes4 constant InterfaceSignature_ERC721 =</span><br><span class="line">    bytes4(keccak256(&apos;name()&apos;)) ^</span><br><span class="line">    bytes4(keccak256(&apos;symbol()&apos;)) ^</span><br><span class="line">    bytes4(keccak256(&apos;totalSupply()&apos;)) ^</span><br><span class="line">    bytes4(keccak256(&apos;balanceOf(address)&apos;)) ^</span><br><span class="line">    bytes4(keccak256(&apos;ownerOf(uint256)&apos;)) ^</span><br><span class="line">    bytes4(keccak256(&apos;approve(address,uint256)&apos;)) ^</span><br><span class="line">    bytes4(keccak256(&apos;transfer(address,uint256)&apos;)) ^</span><br><span class="line">    bytes4(keccak256(&apos;transferFrom(address,address,uint256)&apos;)) ^</span><br><span class="line">    bytes4(keccak256(&apos;tokensOfOwner(address)&apos;)) ^</span><br><span class="line">    bytes4(keccak256(&apos;tokenMetadata(uint256,string)&apos;));</span><br></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">




<div class="article-share" id="share">

  <div data-url="http://xuwenqi.info/2018/03/19/区块链猫源码笔记_1/" data-title="区块链猫源码分析_1 | 徐文起写字的地方" data-tsina="" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2018/03/20/以太坊学习笔记_8以太坊浏览器 - 副本/" title="以太坊学习笔记_8(区块链浏览器)">
  <strong>PREVIOUS:</strong><br/>
  <span>
  以太坊学习笔记_8(区块链浏览器)</span>
</a>
</div>


<div class="next">
<a href="/2018/03/18/以太坊数据结构/"  title="以太坊数据结构学习_1">
 <strong>NEXT:</strong><br/> 
 <span>以太坊数据结构学习_1
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#各个合约的代码"><span class="toc-number">1.</span> <span class="toc-text">各个合约的代码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GeneScienceInterface"><span class="toc-number">1.1.</span> <span class="toc-text">GeneScienceInterface</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ERC721"><span class="toc-number">1.1.1.</span> <span class="toc-text">ERC721</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KittyAccessConrtol"><span class="toc-number">1.2.</span> <span class="toc-text">KittyAccessConrtol</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ownable"><span class="toc-number">1.3.</span> <span class="toc-text">Ownable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#contract-KittyBase-区块链猫的主要代码"><span class="toc-number">1.4.</span> <span class="toc-text">contract KittyBase (区块链猫的主要代码)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#猫的结构体"><span class="toc-number">1.4.1.</span> <span class="toc-text">猫的结构体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pregnancy-time"><span class="toc-number">1.4.2.</span> <span class="toc-text">pregnancy time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#存储"><span class="toc-number">1.4.3.</span> <span class="toc-text">存储</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ERC721Metedata"><span class="toc-number">1.5.</span> <span class="toc-text">ERC721Metedata</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KittyOwnership"><span class="toc-number">1.6.</span> <span class="toc-text">KittyOwnership</span></a></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  

  <div class="rsspart">
	<a href="" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2018 
		
		<a href="http://xuwenqi.info" target="_blank" title="WenqiXu">WenqiXu</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>






  </body>
</html>
